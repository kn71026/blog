---
title: GoogleOAuth
date: 2021-06-02 14:35:49
tags: 
- web
- Google OAuth
categories: api
toc: true
---


å‰›å¥½æœ€è¿‘åœ¨å¯«å°ˆé¡Œçš„ç™»å…¥åŠŸèƒ½ï¼Œæœ‰æ¥åˆ°googleçš„OAuthï¼Œç´€éŒ„ä¸€ä¸‹ä¸­é–“é‡åˆ°çš„å•é¡Œï¼Œè·Ÿæœ€å¾Œè·‘èµ·ä¾†çš„æµç¨‹ã€‚
apiæ¸¬è©¦å·¥å…·ï¼šPostman

## åƒè€ƒæ–‡ä»¶
- [ Googleå®˜æ–¹æ–‡ä»¶](https://developers.google.com/identity/protocols/oauth2)
- [Googleå®˜æ–¹å‰ç«¯ç¯„ä¾‹code](https://developers.google.com/identity/sign-in/web)

## é‹ä½œæµç¨‹

å› ç‚ºå‰ç«¯çš„éƒ¨åˆ†é‚„æ²’å®Œæˆï¼Œæ‰€ä»¥å…ˆä»¥èƒ½ç”¨å¾Œç«¯æ¸¬è©¦çš„æ–¹å¼å»å¯¦ä½œ
![é‹ä½œæµç¨‹](https://raw.githubusercontent.com/kn71026/image/master/image/%E6%B5%81%E7%A8%8B.jpg)
<!-- more -->
1. å‰ç«¯é»æ“Šç™»å…¥æŒ‰éˆ•å¾Œï¼Œé¡¯ç¤ºå¤§å®¶å¸¸çœ‹åˆ°çš„googleç™»å…¥é é¢
2. åœ¨ç™»å…¥æˆåŠŸå¾Œï¼Œgoogleè·³è½‰åˆ°ç‰¹å®šé é¢(å¾Œé¢æœƒè¨­å®š)ï¼Œä¸¦å›å‚³token
3. å‰ç«¯callå¾Œç«¯å¯«çš„apiï¼Œä¸¦å°‡tokenä¸€èµ·å‚³éå»
4. å¾Œç«¯æ¥æ”¶åˆ°tokenå¾Œï¼Œå†callä¸€æ¬¡googleçš„oauth apiï¼Œä¸¦å‚³å…¥å‰ç«¯çµ¦çš„tokenåšäºŒæ¬¡çš„é©—è­‰
5. å¦‚æœtoken(æ²’æœ‰é­åˆ°ä¸²æ”¹æˆ–éæœŸ)ï¼Œæ ¹æ“štokenå¯æ‹¿åˆ°çš„scopeå›å‚³ç‰¹å®šç¯„åœçš„è³‡æ–™
6. å¾Œç«¯æ“·å–æœ‰ç”¨çš„è³‡æ–™å¾Œï¼Œå­˜åˆ°è‡ªå·±å°ˆæ¡ˆçš„DBï¼Œä¸¦å›å‚³è³‡æ–™çµ¦å‰ç«¯

åœ¨éç¨‹ä¸­ï¼Œå› ç‚ºå‰ç«¯è·Ÿå¾Œç«¯ä¹‹é–“åŸºæœ¬ä¸Šæ˜¯æ‹¿tokenåšæºé€šçš„ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦å°‡ä½¿ç”¨è€…çš„å¯†ç¢¼å­˜åˆ°DBä¸­

## Prerequirement

- å…ˆåˆ°[GCP](https://console.cloud.google.com/home/)å»ºç«‹ä¸€å€‹æ–°å°ˆæ¡ˆï¼Œä¹‹å¾Œè¦åœ¨è£¡é¢åšè¨­å®š
- å»ºç«‹å®Œæˆä¹‹å¾Œï¼Œé¸æ“‡å´é‚Šæ¬„çš„APIå’Œæœå‹™ï¼Œä¸¦é»æ“Šæ†‘è­‰ ![APIå’Œæœå‹™](https://raw.githubusercontent.com/kn71026/image/master/image/%E5%81%B4%E6%AC%84.png)
- é€²åˆ°æ†‘è­‰é é¢å¾Œï¼ŒæŒ‰ä¸‹ä¸Šæ–¹çš„å»ºç«‹æ†‘è­‰ï¼Œé¸æ“‡OAuthç”¨æˆ¶ç«¯ID
- å…ˆä¾†è¨­å®šåŒæ„ç•«é¢ï¼Œå¦‚æœæ˜¯åªçµ¦æ©Ÿæ§‹å…§çš„ä½¿ç”¨è€…ä½¿ç”¨(å¦‚ä¹‹å‰çš„Gsuite)ï¼Œå¯ä»¥è¨­å®šå…§éƒ¨ï¼Œå¦‚æœæ˜¯è¦å¤§å®¶éƒ½å¯ä»¥ç™»å…¥ï¼Œå‰‡è¨­å®šå¤–éƒ¨
![è¨­å®šUser Type](https://raw.githubusercontent.com/kn71026/image/master/image/%E5%90%8C%E6%84%8F.jpg)
- ä¸¦æŒ‰ä¸‹å»ºç«‹ï¼Œé–‹å§‹è¨­å®šæ‡‰ç”¨ç¨‹å¼è³‡è¨Šï¼Œä»¥åŠæ”¯æ´ä¿¡ç®±ï¼Œåœ¨é é¢çš„å³é‚Šï¼Œä¹Ÿé¡¯ç¤ºäº†æä¾›çš„è³‡è¨Šæœƒè¢«å¦‚ä½•å±•ç¤º
 ![å„ç¨®è³‡è¨Š](https://raw.githubusercontent.com/kn71026/image/master/image/%E8%B3%87%E8%A8%8A.jpg)
 ![åŒæ„ç•«é¢é¡¯ç¤º](https://raw.githubusercontent.com/kn71026/image/master/image/%E9%A1%AF%E7%A4%BA%E7%95%AB%E9%9D%A2.jpg)
- è¨­å®šæˆæ¬Šç¶²åŸŸï¼Œé€šå¸¸åœ¨æ¸¬è©¦çš„æ™‚å€™æœƒè¨­å®šç‚ºæœ¬åœ°ç«¯(éœ€è¦è¨­å®šå¯¦éš›æ¸¬è©¦æ™‚æ‰èƒ½ä½¿ç”¨)
- è¨­å®šredirect_uriï¼Œä¹Ÿå°±æ˜¯é‡æ–°å°å‘çš„é é¢ï¼Œå›å‚³çš„tokençš„è³‡è¨Šæœƒåœ¨é€™é€™æ®µç¶²å€ä¹‹ä¸­
- æŒ‰ä¸‹å„²å­˜å¾Œï¼Œè¨­å®šç¯„åœ(scope)ï¼Œè¨­å®šä½ çš„æ‡‰ç”¨ç¨‹å¼èƒ½å­˜å–é‚£äº›è³‡è¨Šï¼Œé€™é‚Šè¨­å®šçš„æ˜¯ä½¿ç”¨è€…çš„openidã€emailã€è·Ÿå¸³è™Ÿè³‡è¨Š(å§“ã€åã€é ­è²¼ã€èªç³»)
  ![è¨­å®šç¯„åœ](https://raw.githubusercontent.com/kn71026/image/master/image/%E7%AF%84%E5%9C%8D.png)
- åœ¨æ­£å¼ç™¼å¸ƒå‰ï¼Œæ–°å¢æ¸¬è©¦ä½¿ç”¨è€…ï¼Œåœ¨ç™¼å¸ƒå‰ï¼Œè¦æ˜¯æ¸¬è©¦ä½¿ç”¨è€…æ‰èƒ½ç™»å…¥
  ![è¨­å®šä½¿ç”¨è€…](https://raw.githubusercontent.com/kn71026/image/master/image/%E6%B8%AC%E8%A9%A6%E4%BD%BF%E7%94%A8%E8%80%85.png)
- æœ€å¾Œå›åˆ°æ†‘è­‰é é¢ï¼Œä¸‹è¼‰è¨­å®šæª”
![ä¸‹è¼‰è¨­å®šæª”](https://raw.githubusercontent.com/kn71026/image/master/image/%E8%A8%AD%E5%AE%9A%E6%AA%94.jpg)

åˆ°é€™é‚Šç‚ºæ­¢ï¼Œå‰ç½®ä½œæ¥­å°±å®Œæˆå•¦ï¼Œåœ¨è¨­å®šæª”ä¸­ï¼Œä¸»è¦æœƒç”¨åˆ°çš„æœ‰ï¼š``client_id``ã€``client_secret``

## é‹ä½œæµç¨‹

åœ¨é–‹å§‹ä½¿ç”¨ä¹‹å‰ï¼Œ[å®˜æ–¹çš„æ–‡ä»¶](https://developers.google.com/identity/protocols/oauth2/javascript-implicit-flow#oauth-2.0-endpoints)ä¸­æä¾›äº†å„ç¨®åƒæ•¸çš„è©³ç´°ä»‹ç´¹ã€‚

ä»¥é€™æ¬¡è¦ç”¨åˆ°çš„OAuth 2.0ç‚ºç¯„ä¾‹ï¼Œæœ‰äº›åƒæ•¸æœƒè¨­ç½®ç‚ºå¿…å¡«ï¼š

| Parameters |  |  |
| -------- | -------- | -------- |
| `client_id`  | Required | å°ˆæ¡ˆè¨­å®šæª”ä¸­çš„client_id |
| `redirect_uri`  | Required   | user æˆåŠŸç™»å…¥å¾Œ redirects çš„  URI  |
| `response_type`   | Required  |  å›å‚³æ ¼å¼ï¼Œé€™é‚Šè¨­ç‚ºtoken |
| `scope`    | Required  | å…è¨±å­˜å–çš„ç¯„åœ    |


### åŸ·è¡Œæ­¥é©Ÿ
1. é€²åˆ°googleç™»å…¥çš„ç•«é¢(å¯æ‰‹åˆ»æŒ‰éˆ•æˆ–æ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„ç´ æ)
2. å¯ä»¥çœ‹ä¸€ä¸‹åœ¨ç™»å…¥ç•«é¢çš„ç¶²å€ä¸­æœ‰å“ªäº›è³‡è¨Š
![URLå…§å®¹](https://raw.githubusercontent.com/kn71026/image/master/image/url.png)
3. è‹¥æˆåŠŸç™»å…¥å¾Œï¼Œå‰‡æœƒå°å‘å‰é¢è¨­å®šçš„`redirect_uri`ï¼Œä¸¦æ‹¿åˆ°å›å‚³çš„token
![å›å‚³çš„token](https://raw.githubusercontent.com/kn71026/image/master/image/token.png)
4. call OAuth api æ‹¿åˆ°ä½¿ç”¨è€…çš„è³‡æ–™
![å‘¼å«æˆåŠŸ!](https://raw.githubusercontent.com/kn71026/image/master/image/postman.png)

## å¾ŒçºŒè™•ç†
ä¹‹å¾Œå°±èƒ½åœ¨è‡ªå·±å¾Œç«¯çš„codeä¸­ï¼Œä»¥é¡ä¼¼çš„æ–¹å¼å»ä¸²æ¥Googleå¸³è™Ÿäº†ğŸ‰ğŸ‰ğŸ‰